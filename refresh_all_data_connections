Private Sub Refresh_All_Data_Connections()

'    intConnections = ActiveWorkbook.Connections.Count - 1
'    cntConnections = 1
    
    Application.DisplayAlerts = False
    
    On Error GoTo ErrorHandler
    
    For Each objConnection In ActiveWorkbook.Connections
        
        'Get current background-refresh value
        bBackground = objConnection.OLEDBConnection.BackgroundQuery
        
        'Temporarily disable background-refresh
        objConnection.OLEDBConnection.BackgroundQuery = False

        'Refresh this connection
        objConnection.Refresh

        'Set background-refresh value back to original value
        objConnection.OLEDBConnection.BackgroundQuery = bBackground
'        If intConnections = cntConnections Then
'            Exit For
'        Else
'            cntConnections = cntConnections + 1
'        End If
    Next

    Application.DisplayAlerts = True

ErrorHandler:
    If Err.Number <> 0 Then
        errRefresh = "Y"
        errMsg = "Error # " & Str(Err.Number) & " was generated by " _
         & Err.Source & Chr(13) & "Error Line: " & Erl & Chr(13) & Err.Description
    Else
        errRefresh = "N"
    End If

End Sub
